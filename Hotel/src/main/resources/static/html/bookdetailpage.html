<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
 
 <meta charset="UTF-8"> 
<title>Insert title here</title>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<link href="../css/bookpage.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" th:inline="javascript">

$(document).ready(function(){
	var url = window.location.href;

    var typeid = url.split("?")[1].split("&")[0].split("=")[1]
    var inTime = url.split("&")[1].split("=")[1]; 
    var outTime = url.split("&")[2].split("=")[1];
    var img = url.split("&")[3].split("=")[1];
    var price = url.split("&")[4].split("=")[1];
    var description = url.split("&")[5].split("=")[1];
    var type = url.split("&")[6].split("=")[1];
    var livedays = url.split("&")[7].split("=")[1];
    
    var roomtype = decodeURI(type);
    var roominfo = decodeURI(description);
    $("#inTime").html(inTime);
    $("#outTime").html(outTime);
    document.getElementById("typeid").value = parseInt(typeid);

 
    document.getElementById("pic").src = img; 
    $("#price").html(parseInt(price)*parseInt(livedays));  
    $("#type").html(roomtype);
    $("#roominfo").html(roominfo);
    
    //遍历出该用户的所有房客资料
 $.ajax({
	 url:"../loginer/allPerson", 
	 success:function(data){
		 for (var i = 0; i < data.length; i++) {
  			    var tr=$("<tr></tr>")
  			    if(i==0){
  			    	var radio = $("<td style='text-align:center'></td>").html("<input type='radio' name='passenger' value='"+data[i].person_id+"' checked='checked'>");
  			    }else{
  			    	var radio = $("<td style='text-align:center'></td>").html("<input type='radio' name='passenger' value='"+data[i].person_id+"'>");
  			    }
				
				var name=$("<td style='text-align:center'></td>").html(data[i].name);
				var idcard=$("<td style='text-align:center'></td>").html(data[i].idcard);
				var tel=$("<td style='text-align:center'></td>").html(data[i].tel);
				
				tr.append(radio);
				tr.append(name);
				tr.append(idcard);
				tr.append(tel);
				$("#passenger").append(tr);
			  }					 
	 }
	 
 }) 
 //遍历出所有用户的评价
 $.ajax({
      url:"../comment/all",	
      data:{typeid:$("#typeid").val()},
	  success:function(data){
		  alert(data)
		  for (var i = 0; i < data.length; i++) {
			  var div1=$("<div class='media'></div>"); 
			  var div=$("<div class='media-body'></div>");	    
			  var uid=$("<h4 class='media-heading'></h4>").text("用户:"+data[i].loginid);
			  var comment=$("<p></p>").text(data[i].description);
			  var hr=$("<hr>");	
			  div1.append(div);
			  div1.append(uid);
			  div1.append(comment)
			  div1.append(hr);
			  $("#commentbox").append(div1);
		}	  
	  }	 
 })
 
 
  
            })
            
 /*添加房客  */        
 function addPassenger(){
	$.ajax({
		url:"../person/addperson",
		data:{
			name:$("#name").val(),
			tel:$("#tel").val(),
			idcard:$("#idcard").val(),
		},
		success:function(data){
			var tr=$("<tr></tr>")
			var radio = $("<td style='text-align:center'></td>").html("<input type='radio' name='passenger' value='"+data.person_id+"'>");
			var name=$("<td style='text-align:center'></td>").html(data.name);
			var idcard=$("<td style='text-align:center'></td>").html(data.idcard);
			var tel=$("<td style='text-align:center'></td>").html(data.tel);
			tr.append(radio);
			tr.append(name);
			tr.append(idcard);
			tr.append(tel);
			$("#passenger").append(tr);
		}
		
			
		}) 
	
}

  /*提交订单 */ 
  function submitOrder(){
	  var list = [$('input[name="passenger"]:checked').val()];
	 $.ajax({
		 url:"/order/create",
		 data:{
			 "in_time":$("#inTime").html(),
			 "out_time":$("#outTime").html(),
			 "typeID":$("#typeid").val(),
		     "persons":[$('input[name="passenger"]:checked').val()],	
	         "in_air":$('input[name="airService"]:checked').val(),
	         "order_state":$('input[name="offlinepay"]:checked').val(),	 
	         "msg":$("#msg").val()
		 },
		 
		success:function(data){
			var msg=data.msg;
			alert(data)
			if(msg.search("成功")!=-1){			
			 location.href="/order/page?orderid="+data.orderid;	 		
			}
		} 	 
	 })    
  }
  /*提交订单 */ 
  
</script>


</head>
<body>
<input type="hidden" id="typeid">

	<div class="head">
	<div class="headtitle">罗马假日酒店</div>
	
	
	<div class="loginimg"><img src="../img/register.png" /> </div>
	<div class="login">用户：</div>
    <div class="login" th:text=${session.uid}></div>
	</div>	

	<div class="typedetail">
	预定信息<br>
	
	<img  id="pic" style="width:120px"/><br>
	房间类型:<span id="type" ></span><br>
	基本信息:<span id="roominfo" ></span><br>
	入住时间:<span id="inTime" ></span><br>
	离开时间:<span id="outTime" ></span><br>
	单间费用:<span id="price" style="color:red"></span>
	
	</div>
	
	
	<!-- 入住房客信息  -->
	
	<table class="table table-striped" style="width:600px;margin:auto">
	<thead>
		<tr>
		    <th style='text-align:center'>选择房客</th>
			<th style='text-align:center'>姓名</th>
			<th style='text-align:center'>身份证</th>
			<th style='text-align:center'>电话</th>
			
			
		</tr>
	</thead>
	<tbody id="passenger">
		
	</tbody>
</table>
<br>
<br>
<div class="row">
  <div align="center" >
    <form class="form-inline" role="form" onsubmit="return false;">
	<div class="form-group">
		<label class="sr-only" for="name">名称</label>
		<input type="text" class="form-control" id="name" 
			   placeholder="请输入姓名">
	</div>
	<div class="form-group">
		<label class="sr-only" for="idcard">名称</label>
		<input type="text" class="form-control" id="idcard" 
			   placeholder="请输身份证">
	</div>
	<div class="form-group">
		<label class="sr-only" for="tel">名称</label>
		<input type="text" class="form-control" id="tel" 
			   placeholder="请输电话">
	</div>
	
	<button type="submit" class="btn btn-default" onclick="addPassenger()">添加</button>
</form>
  </div>
</div>
<br><br>
<!-- 是否接机 -->
<div class="row">
  <div align="center" >
  		是否接机：是：<input type="radio" name="airService" value=0 >
  		                   否：<input type="radio" name="airService" value=1 checked="checked">
  </div>
</div>
<!-- 是否线下支付 -->
<div class="row">
  <div align="center" >
                   线上支付：<input type="radio" name="offlinepay" value=0 checked="checked">
  		线下支付：<input type="radio" name="offlinepay" value=2>
  </div>
</div>
<div class="row">
  <div align="center" >
  		留言：<input type="text" id="msg">
  </div>
</div>
<!-- 提交订单按钮 -->
<button class="bookbutton" onclick="submitOrder()">提交订单</button>

<!--用户评价 -->
<div class="container" id="commentbox">
  <h3>用户评价</h3> 
  </div>
<!--用户评价 -->  
</body>
</html>